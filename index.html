<!doctype html>
<html lang="ko">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>롤 팀 경매 시스템</title>
    <link rel="stylesheet" href="style.css" />
  </head>
  <body>
    <!-- 디버깅 버튼들 -->
    <div class="debug-panel" id="debugPanel">
      <div class="debug-toggle" id="debugToggle">🔧</div>
      <div class="debug-buttons hidden" id="debugButtons">
        <button id="debugGoToConfig" class="debug-btn">설정 화면</button>
        <button id="debugGoToIntro" class="debug-btn">팀장 소개</button>
        <button id="debugGoToAuction" class="debug-btn">본경매</button>
        <button id="debugGoToComplete" class="debug-btn">경매 결과</button>
        <button id="debugCreateSampleData" class="debug-btn">샘플 데이터</button>
      </div>
    </div>

    <header>
      <div class="title">
        <h1>롤 팀 경매 시스템</h1>
        <div class="sub">오프라인 진행</div>
      </div>

      <div class="header-controls">
        <div class="timer-display-section">
          <span id="timerDisplay" class="timer-main-display">00:30</span>
          <div class="timer-quick-controls">
            <button id="timerStart" class="timer-btn">시작</button>
            <button id="timerStop" class="timer-btn">정지</button>
          </div>
        </div>

        <div class="settings-dropdown">
          <button id="settingsToggle" class="settings-btn" title="설정">⚙️</button>
          <div id="settingsPanel" class="settings-panel hidden">
            <div class="setting-section">
              <div class="setting-group">
                <label class="setting-item">
                  <input type="checkbox" id="timerEnabled" checked />
                  <span>타이머 사용</span>
                </label>
                <div class="timer-setting">
                  <label for="timerSeconds">시간(초)</label>
                  <input type="number" id="timerSeconds" value="30" min="5" max="300" />
                </div>
              </div>

              <div class="setting-group">
                <label class="setting-item">
                  <input type="checkbox" id="soundEnabled" checked />
                  <span>알림음</span>
                </label>
                <button id="soundTestBtn" class="test-btn">테스트</button>
              </div>

              <div class="setting-group">
                <label for="soundVolume" class="volume-label">볼륨</label>
                <div class="volume-control">
                  <input type="range" id="soundVolume" min="0" max="100" value="70" />
                  <span id="soundVolumeLabel">70%</span>
                </div>
              </div>

            </div>
          </div>
        </div>
      </div>
    </header>

    <main>
      <section class="config" id="config">
        <h2>설정</h2>
        <div class="teamnames">
          <label>팀 이름</label>
          <div id="teamNames" class="teams-inputs"></div>
          <div class="hint">팀 수는 전체 인원 ÷ 5(올림)로 결정됩니다.</div>
        </div>
        
        <div class="grid">
          <div>
            <label><input type="checkbox" id="useLeadersAsTeamNames" checked /> 팀장 이름을 팀명으로 사용</label>
            <div class="hint">선수 카드에서 팀장을 선택하세요.</div>
            
            <label><input type="checkbox" id="enforceRoles" /> 포지션(Top/Jungle/Mid/ADC/Support) 중복 방지</label>
            <label><input type="checkbox" id="randomizeOrder" checked /> 경매 순서 무작위 추첨</label>
            <label><input type="checkbox" id="nominationMode" /> 지명(턴제) 모드 사용</label>
            <div id="randomizeTeamOrderContainer" class="hidden">
              <label><input type="checkbox" id="randomizeTeamOrder" /> 팀 순서 무작위(입찰 팀 목록 섞기)</label>
            </div>
            <div class="hint">입찰은 5포인트 단위, 시작가 5포인트</div>
          </div>
        </div>
        <div class="actions">
          <button id="startBtn">경매 시작</button>
          <button id="loadStateBtn">이전 상태 불러오기</button>
          <button id="resetBtn" class="ghost">초기화</button>
        </div>
      </section>

      <!-- 사이트 하단에 고정된 선수 카드 영역 -->
      <section class="players-section" id="playersSection">
        <div class="topbar">
          <h2>선수 카드</h2>
          <button id="togglePlayersSection" class="ghost">접기</button>
        </div>
        <div class="pcount">
          <label for="totalPlayers">전체 인원수</label>
          <input type="number" id="totalPlayers" value="20" min="1" max="200" />
          <span class="hint">각 카드 이미지 영역에 드래그 또는 클릭 업로드 가능 | 권장 비율: 4:3 (예: 800×600px)</span>
        </div>
        <div class="actions">
          <button id="rebuildCardsBtn" class="ghost">선수카드 다시 생성</button>
        </div>
        <div id="playerCards" class="player-cards"></div>
      </section>

      <section class="team-introduction hidden" id="teamIntroduction">
        <div class="intro-header">
          <h2>🎯 팀장 소개 및 경매 안내</h2>
          <p class="intro-subtitle">각 팀장들과 예산을 확인하고 경매를 시작하세요</p>
        </div>

        <div class="leaders-grid" id="leadersGrid">
          <!-- 팀장 카드들이 여기에 표시됩니다 -->
        </div>

        <div class="auction-rules">
          <h3>📋 경매 규칙</h3>
          <div class="rules-grid">
            <div class="rule-item">
              <div class="rule-icon">💰</div>
              <div class="rule-content">
                <strong>입찰 방식</strong>
                <p>5포인트 단위로 입찰, 시작가 5포인트</p>
              </div>
            </div>
            <div class="rule-item">
              <div class="rule-icon">🎲</div>
              <div class="rule-content">
                <strong>경매 순서</strong>
                <p id="auctionOrderRule">설정에 따라 결정됩니다</p>
              </div>
            </div>
            <div class="rule-item">
              <div class="rule-icon">🔄</div>
              <div class="rule-content">
                <strong>유찰 처리</strong>
                <p>본경매 → 유찰라운드 1 → 유찰라운드 2 → 랜덤배정</p>
              </div>
            </div>
            <div class="rule-item" id="roleEnforcementRule">
              <div class="rule-icon">⚡</div>
              <div class="rule-content">
                <strong>포지션 제한</strong>
                <p id="roleEnforcementText">설정에 따라 결정됩니다</p>
              </div>
            </div>
          </div>
        </div>

        <div class="intro-actions">
          <button id="backToConfigBtn" class="ghost">설정으로 돌아가기</button>
          <button id="startAuctionFromIntroBtn" class="primary">경매 시작!</button>
        </div>
      </section>

      <section class="auction hidden" id="auction">
        <!-- 상단 라운드 정보 -->
        <div class="auction-header">
          <div class="auction-round-info">
            <div class="round-section">
              <div class="label">라운드</div>
              <div id="roundText" class="pill">본경매</div>
            </div>
            <div class="queue-section">
              <div class="label">남은 선수</div>
              <div id="remainingCount" class="pill">0</div>
            </div>
            <div id="roundDescription" class="round-description">
              모든 선수를 경매합니다
            </div>
          </div>
        </div>

        <!-- 메인 경매 영역 -->
        <div class="auction-layout">
          <!-- 왼쪽 팀들 -->
          <div class="teams-left" id="teamsLeft">
            <!-- 왼쪽 팀들이 여기에 표시됩니다 -->
          </div>

          <!-- 중앙 선수 정보 -->
          <div class="player-center">
            <div class="current-player-header">
              <div class="label">현재 선수</div>
              <div id="currentPlayer" class="pill">
                <img id="currentPlayerImage" class="player-icon" src="assets/roles/jungler.png" alt="선수 역할 아이콘">
                <span id="currentPlayerNameAndRole">-</span>
              </div>
            </div>

            <div class="player-image-section">
              <div class="image-frame" id="currentImageWrap">
                <img id="currentImage" alt="현재 선수 이미지" />
              </div>
              <div class="image-caption" id="currentImageCaption"></div>
            </div>

            <div class="player-info-horizontal">
              <div class="player-tier-section">
                <div class="label">티어</div>
                <div id="currentTier" class="tier-display">-</div>
              </div>
              <div class="player-roles-section">
                <div class="label">라인</div>
                <div id="currentRoles" class="roles-display">-</div>
              </div>
              <div class="player-quote-section">
                <div class="label">각오</div>
                <div id="currentQuote" class="quote-display">-</div>
              </div>
            </div>

            <div class="bid-status">
              <div class="highest-bid">
                <span class="label">최고 입찰</span>
                <span id="highestText" class="bid-amount">-</span>
              </div>
            </div>
          </div>

          <!-- 오른쪽 팀들 -->
          <div class="teams-right" id="teamsRight">
            <!-- 오른쪽 팀들이 여기에 표시됩니다 -->
          </div>
        </div>

        <!-- 하단 경매 컨트롤 -->
        <div class="auction-controls">
          <div class="control-group">
            <label>입찰 팀</label>
            <select id="bidTeam"></select>
          </div>
          <div class="control-group">
            <label>입찰 금액</label>
            <input type="number" id="bidAmount" min="5" step="5" value="5" />
          </div>
          <div class="control-buttons">
            <button id="placeBidBtn">입찰</button>
            <button id="assignBtn" class="primary">낙찰 처리</button>
            <button id="skipBtn" class="ghost">패스</button>
            <button id="undoBtn">되돌리기</button>
            <button id="nominateBtn" class="ghost">지명</button>
          </div>
        </div>

        <!-- 지명 모드 & 기타 컨트롤 -->
        <div class="auction-extras">
          <div id="nominatorBar" class="nominator-info">지명 팀: <span id="nominatorTeam">-</span></div>
          <div id="nominateBox" class="nominate-controls hidden">
            <label>지명할 선수 선택</label>
            <select id="nominateSelect"></select>
            <button id="nominateConfirm">확정</button>
            <button id="nominateCancel" class="ghost">취소</button>
          </div>

          <div class="persist-controls">
            <button id="saveBtn">상태 저장</button>
            <button id="exportCsvBtn">CSV 내보내기</button>
            <button id="exportJsonBtn" class="ghost">JSON 내보내기</button>
          </div>
        </div>
      </section>

      <section class="auction-complete hidden" id="auctionComplete">
        <div class="complete-header">
          <h2>🏆 경매 완료!</h2>
          <div class="complete-stats">
            <div class="stat-item">
              <span class="stat-label">총 참여 선수</span>
              <span id="totalPlayersCount" class="stat-value">0</span>
            </div>
            <div class="stat-item">
              <span class="stat-label">평균 낙찰가</span>
              <span id="averagePrice" class="stat-value">0</span>
            </div>
            <div class="stat-item">
              <span class="stat-label">최고 낙찰가</span>
              <span id="highestPrice" class="stat-value">0</span>
            </div>
          </div>
          <div class="auction-info">
            <p><strong>경매 진행 방식:</strong> 본경매 → 유찰라운드 1 → 유찰라운드 2 → 랜덤배정</p>
            <p><span class="random-badge">랜덤</span> 표시는 2회 유찰 후 자동 배정된 선수입니다.</p>
          </div>
        </div>

        <div class="final-teams" id="finalTeams">
          <!-- 팀별 최종 구성이 여기에 표시됩니다 -->
        </div>

        <div id="unsoldPlayersSection" class="unsold-section hidden">
          <h3>미판매 선수</h3>
          <div id="unsoldPlayersList" class="unsold-list">
            <!-- 미판매 선수 목록이 여기에 표시됩니다 -->
          </div>
        </div>

        <div class="complete-actions">
          <button id="exportFinalCsvBtn" class="primary">결과 CSV 내보내기</button>
          <button id="exportFinalJsonBtn" class="secondary">결과 JSON 내보내기</button>
          <button id="startNewAuctionBtn" class="ghost">새 경매 시작</button>
        </div>
      </section>

    </main>

    <footer>
      <div class="footer-content">
        <div class="footer-info">
          <small>오프라인 전용. 브라우저 LocalStorage 저장 지원.</small><br/>
          <small>Made by <strong>Mad-Nut</strong> | <a href="https://github.com/Dev-Nut00" target="_blank" rel="noopener">GitHub</a></small><br/>
          <small>League of Legends 및 관련 이미지의 저작권은 Riot Games, Inc.에 있습니다. This application is not endorsed by Riot Games and does not reflect the views or opinions of Riot Games or anyone officially involved in producing or managing Riot Games properties.</small>
        </div>
        <div class="footer-controls">
          <div class="footer-control-group">
            <label for="uiScaleFooter">UI 크기</label>
            <select id="uiScaleFooter">
              <option value="small">작게</option>
              <option value="normal" selected>보통</option>
              <option value="large">크게</option>
            </select>
          </div>
        </div>
      </div>
    </footer>

    <script src="app.js"></script>
  </body>
</html>
